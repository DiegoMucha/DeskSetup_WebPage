<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Todos los Productos - DeskSetup Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style-footer.css/style-footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <!--Nav Bar-->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a href="./index.html" target="_top">
                <img src="images/icons/ds.e931c4593e6d86f4aa7c.png" alt="Logo" class="rounded" width="70" height="65">
            </a>
            <ul class="navbar-nav ms-3 mb-2 mb-lg-0 flex-row align-items-center">
                <li class="nav-item ms-3">
                    <a class="nav-link" href="./productos.html" target="_top">Productos</a>
                </li>
                <li class="nav-item ms-3">
                    <a class="nav-link" href="./resenas.html" target="_top">Reseñas</a>
                </li>
                <li class="nav-item ms-3">
                    <a class="nav-link" href="./carrito.html" target="_top">Carrito</a>
                </li>
            </ul>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="#navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item" href="./login.html" target="_top">Ingresar</a></li>
                            <li><a class="dropdown-item" href="./micuenta.html" target="_top">Mi Cuenta</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-5">
        <h1 class="text-center mb-5">Todos los Productos</h1>

        <!-- Filtros -->
        <div class="row mb-4">
            <div class="col-md-6">
                <label for="filtro-precio" class="form-label">Filtrar por precio máximo:</label>
                <input type="number" id="filtro-precio" class="form-control" placeholder="Ejemplo: 1000">
            </div>
            <div class="col-md-6">
                <label for="filtro-stock" class="form-label">Filtrar por stock mínimo:</label>
                <input type="number" id="filtro-stock" class="form-control" placeholder="Ejemplo: 10">
            </div>
        </div>

        <div class="row" id="contenedor-productos">
            <!-- Productos cargados dinámicamente -->
        </div>
    </div>
    <iframe src="footer.html" width="100%" height="130" style="border:none; overflow:hidden;"></iframe>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function agregarAlCarrito(producto) {
            let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            carrito.push(producto);
            localStorage.setItem('carrito', JSON.stringify(carrito));
            alert('Producto agregado al carrito');
        }

        function cargarProductos() {
            fetch("http://40.118.212.141/crud_productos.php?action=all")
                .then(res => res.json())
                .then(data => {
                    mostrarProductos(data);

                    // Agregar eventos a los filtros
                    document.getElementById('filtro-precio').addEventListener('input', () => filtrarProductos(data));
                    document.getElementById('filtro-stock').addEventListener('input', () => filtrarProductos(data));
                })
                .catch(err => {
                    document.getElementById("contenedor-productos").innerHTML = '<p class="text-danger">No se pudieron cargar los productos.</p>';
                });
        }

        function mostrarProductos(productos) {
            const contenedor = document.getElementById("contenedor-productos");
            contenedor.innerHTML = '';

            if (!productos || productos.length === 0) {
                contenedor.innerHTML = '<p class="text-center text-danger">No hay productos disponibles.</p>';
                return;
            }

            productos.forEach(producto => {
                const col = document.createElement("div");
                col.className = "col-lg-4 col-md-6 col-sm-12 mb-4";
                col.innerHTML = `
                    <div class=\"card h-100\">
                        <img src=\"${producto.imagen_url || 'images/SLIDE/setup1.jpg'}\" class=\"card-img-top\" alt=\"${producto.nombre}\">
                        <div class=\"card-body\">
                            <h5 class=\"card-title\">${producto.nombre}</h5>
                            <p class=\"card-text\"><strong>Marca:</strong> ${producto.marca || ''}</p>
                            <p class=\"card-text\">${producto.descripcion || ''}</p>
                            <p class=\"card-text\"><strong>Precio:</strong> $${producto.precio}</p>
                            <p class=\"card-text\"><strong>Stock:</strong> ${producto.stock}</p>
                            <button onclick='agregarAlCarrito(${JSON.stringify(producto)})' class=\"btn btn-primary\">
                                <i class=\"fas fa-cart-plus\"></i> Comprar
                            </button>
                        </div>
                    </div>
                `;
                contenedor.appendChild(col);
            });
        }

        function filtrarProductos(productos) {
            const precioMax = parseFloat(document.getElementById('filtro-precio').value) || Infinity;
            const stockMin = parseInt(document.getElementById('filtro-stock').value) || 0;

            const productosFiltrados = productos.filter(producto => 
                producto.precio <= precioMax && producto.stock >= stockMin
            );

            mostrarProductos(productosFiltrados);
        }

        document.addEventListener('DOMContentLoaded', cargarProductos);
    </script>
</body>
</html>
